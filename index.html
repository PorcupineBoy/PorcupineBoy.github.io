<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-dataFrame的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/dataFrame%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-09-27T01:22:29.922Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="DataFrame详解"><a href="#DataFrame详解" class="headerlink" title="DataFrame详解"></a>DataFrame详解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：spark 2.4.0</span><br><span class="line">slaca :2.12以上</span><br></pre></td></tr></table></figure>

<h4 id="创建DataFrame的几种方式"><a href="#创建DataFrame的几种方式" class="headerlink" title="创建DataFrame的几种方式"></a>创建DataFrame的几种方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一种：rdd 转DF</span><br><span class="line">import session.implict._</span><br><span class="line">val df&#x3D; rdd.toDF(#columnName)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;**</span><br><span class="line">     * 创建一个空的DataFrame，代表用户</span><br><span class="line">     * 有四列，分别代表ID、名字、年龄、生日</span><br><span class="line">     *&#x2F;</span><br><span class="line">    val colNames &#x3D; Array(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;, &quot;birth&quot;)</span><br><span class="line">    &#x2F;&#x2F;为了简单起见，字段类型都为String</span><br><span class="line">    val schema &#x3D; StructType(colNames.map(fieldName &#x3D;&gt; StructField(fieldName, StringType, true)))</span><br><span class="line">    &#x2F;&#x2F;主要是利用了spark.sparkContext.emptyRDD</span><br><span class="line">    val emptyDf &#x3D; spark.createDataFrame(spark.sparkContext.emptyRDD[Row], schema)</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">**</span><br><span class="line">**</span><br><span class="line">&#x2F;</span><br><span class="line">val empty&#x3D; spark.emptyDataFrame.withColumn()</span><br></pre></td></tr></table></figure>



<h4 id="DataFrame的方法"><a href="#DataFrame的方法" class="headerlink" title="DataFrame的方法"></a>DataFrame的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">DataFrame 的函数</span><br><span class="line">Action 操作</span><br><span class="line">1、 collect() ,返回值是一个数组，返回dataframe集合所有的行</span><br><span class="line">2、 collectAsList() 返回值是一个Java类型的数组，返回dataframe集合所有的行</span><br><span class="line">3、 count() 返回一个number类型的，返回dataframe集合的行数</span><br><span class="line">4、 describe(cols: String*) 返回一个通过数学计算的类表值(count, mean, stddev, min, and max)，这个可以传多个参数，中间用逗号分隔，如果有字段为空，那么不参与运算，只这对数值类型的字段。例如df.describe(&quot;age&quot;, &quot;height&quot;).show()</span><br><span class="line">5、 first() 返回第一行 ，类型是row类型</span><br><span class="line">6、 head() 返回第一行 ，类型是row类型</span><br><span class="line">7、 head(n:Int)返回n行  ，类型是row 类型</span><br><span class="line">8、 show()返回dataframe集合的值 默认是20行，返回类型是unit</span><br><span class="line">9、 show(n:Int)返回n行，，返回值类型是unit</span><br><span class="line">10、 table(n:Int) 返回n行  ，类型是row 类型</span><br><span class="line"></span><br><span class="line">dataframe的基本操作</span><br><span class="line">1、 cache()同步数据的内存</span><br><span class="line">2、 columns 返回一个string类型的数组，返回值是所有列的名字</span><br><span class="line">3、 dtypes返回一个string类型的二维数组，返回值是所有列的名字以及类型</span><br><span class="line">4、 explan()打印执行计划  物理的</span><br><span class="line">5、 explain(n:Boolean) 输入值为 false 或者true ，返回值是unit  默认是false ，如果输入true 将会打印 逻辑的和物理的</span><br><span class="line">6、 isLocal 返回值是Boolean类型，如果允许模式是local返回true 否则返回false</span><br><span class="line">7、 persist(newlevel:StorageLevel) 返回一个dataframe.this.type 输入存储模型类型</span><br><span class="line">8、 printSchema() 打印出字段名称和类型 按照树状结构来打印</span><br><span class="line">9、 registerTempTable(tablename:String) 返回Unit ，将df的对象只放在一张表里面，这个表随着对象的删除而删除了</span><br><span class="line">10、 schema 返回structType 类型，将字段名称和类型按照结构体类型返回</span><br><span class="line">11、 toDF()返回一个新的dataframe类型的</span><br><span class="line">12、 toDF(colnames：String*)将参数中的几个字段返回一个新的dataframe类型的，</span><br><span class="line">13、 unpersist() 返回dataframe.this.type 类型，去除模式中的数据</span><br><span class="line">14、 unpersist(blocking:Boolean)返回dataframe.this.type类型 true 和unpersist是一样的作用false 是去除RDD</span><br><span class="line"></span><br><span class="line">集成查询：</span><br><span class="line">1、 agg(expers:column*) 返回dataframe类型 ，同数学计算求值</span><br><span class="line">df.agg(max(&quot;age&quot;), avg(&quot;salary&quot;))</span><br><span class="line">df.groupBy().agg(max(&quot;age&quot;), avg(&quot;salary&quot;))</span><br><span class="line">2、 agg(exprs: Map[String, String])  返回dataframe类型 ，同数学计算求值 map类型的</span><br><span class="line">df.agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;,&quot;phone&quot;,&quot;count&quot;))</span><br><span class="line">df.groupBy().agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">3、 agg(aggExpr: (String, String), aggExprs: (String, String)*)  返回dataframe类型 ，同数学计算求值</span><br><span class="line">df.agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">df.groupBy().agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">4、 apply(colName: String) 返回column类型，捕获输入进去列的对象</span><br><span class="line">5、 as(alias: String) 返回一个新的dataframe类型，就是原来的一个别名</span><br><span class="line">6、 col(colName: String)  返回column类型，捕获输入进去列的对象</span><br><span class="line">7、 cube(col1: String, cols: String*) 返回一个GroupedData类型，根据某些字段来汇总</span><br><span class="line">8、 distinct 去重 返回一个dataframe类型</span><br><span class="line">9、 drop(col: Column) 删除某列 返回dataframe类型</span><br><span class="line">10、 dropDuplicates(colNames: Array[String]) 删除相同的列 返回一个dataframe</span><br><span class="line">11、 except(other: DataFrame) 返回一个dataframe，返回在当前集合存在的在其他集合不存在的</span><br><span class="line">12、 explode[A, B](inputColumn: String, outputColumn: String)(f: (A) ⇒ TraversableOnce[B])(implicit arg0: scala.reflect.api.JavaUniverse.TypeTag[B]) 返回值是dataframe类型，这个 将一个字段进行更多行的拆分</span><br><span class="line">df.explode(&quot;name&quot;,&quot;names&quot;) &#123;name :String&#x3D;&gt; name.split(&quot; &quot;)&#125;.show();</span><br><span class="line">将name字段根据空格来拆分，拆分的字段放在names里面</span><br><span class="line">13、 filter(conditionExpr: String): 刷选部分数据，返回dataframe类型 df.filter(&quot;age&gt;10&quot;).show();  df.filter(df(&quot;age&quot;)&gt;10).show();   df.where(df(&quot;age&quot;)&gt;10).show(); 都可以</span><br><span class="line">14、 groupBy(col1: String, cols: String*) 根据某写字段来汇总返回groupedate类型   df.groupBy(&quot;age&quot;).agg(Map(&quot;age&quot; -&gt;&quot;count&quot;)).show();df.groupBy(&quot;age&quot;).avg().show();都可以</span><br><span class="line">15、 intersect(other: DataFrame) 返回一个dataframe，在2个dataframe都存在的元素</span><br><span class="line">16、 join(right: DataFrame, joinExprs: Column, joinType: String)</span><br><span class="line">一个是关联的dataframe，第二个关联的条件，第三个关联的类型：inner, outer, left_outer, right_outer, leftsemi</span><br><span class="line">df.join(ds,df(&quot;name&quot;)&#x3D;&#x3D;&#x3D;ds(&quot;name&quot;) and  df(&quot;age&quot;)&#x3D;&#x3D;&#x3D;ds(&quot;age&quot;),&quot;outer&quot;).show();</span><br><span class="line">17、 limit(n: Int) 返回dataframe类型  去n 条数据出来</span><br><span class="line">18、 na: DataFrameNaFunctions ，可以调用dataframenafunctions的功能区做过滤 df.na.drop().show(); 删除为空的行</span><br><span class="line">df.na.fill(0)  为null的填充0</span><br><span class="line">19、 orderBy(sortExprs: Column*) 做alise排序</span><br><span class="line">20、 select(cols:string*) dataframe 做字段的刷选 df.select($&quot;colA&quot;, $&quot;colB&quot; + 1)</span><br><span class="line">21、 selectExpr(exprs: String*) 做字段的刷选 df.selectExpr(&quot;name&quot;,&quot;name as names&quot;,&quot;upper(name)&quot;,&quot;age+1&quot;).show();</span><br><span class="line">22、 sort(sortExprs: Column*) 排序 df.sort(df(&quot;age&quot;).desc).show(); 默认是asc</span><br><span class="line">23、 unionAll(other:Dataframe) 合并 df.unionAll(ds).show();</span><br><span class="line">24、 withColumnRenamed(existingName: String, newName: String) 修改列表 df.withColumnRenamed(&quot;name&quot;,&quot;names&quot;).show();</span><br><span class="line">25、 withColumn(colName: String, col: Column) 增加一列 df.withColumn(&quot;aa&quot;,df(&quot;name&quot;)).show();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">四、如何设置合理的分区数</span><br><span class="line"></span><br><span class="line">1、分区数越多越好吗？</span><br><span class="line"></span><br><span class="line">不是的，分区数太多意味着任务数太多，每次调度任务也是很耗时的，所以分区数太多会导致总体耗时增多。</span><br><span class="line"></span><br><span class="line">2、分区数太少会有什么影响？</span><br><span class="line"></span><br><span class="line">分区数太少的话，会导致一些结点没有分配到任务；另一方面，分区数少则每个分区要处理的数据量就会增大，从而对每个结点的内存要求就会提高；还有分区数不合理，会导致数据倾斜问题。</span><br><span class="line"></span><br><span class="line">3、合理的分区数是多少？如何设置？</span><br><span class="line"></span><br><span class="line">总核数&#x3D;executor-cores * num-executor </span><br><span class="line"></span><br><span class="line">一般合理的分区数设置为总核数的2~3倍</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">一 repartition(numPartitions, *cols) 重新分区(内存中，用于并行度)，用于分区数变多，设置变小一般也只是action算子时才开始shuffing;而且当参数numPartitions小于当前分区个数时会保持当前分区个数等于失效。</span><br><span class="line">	df.reparition(100,&quot;month&quot;)</span><br><span class="line">1</span><br><span class="line">二 partitionBy(*cols) 根据指定列进行分区（主要磁盘存储，影响生成磁盘文件数量，后续再从存储中载入影响并行度），相似的在一个区，并没有参数来指定多少个分区，而且仅用于PairRdd</span><br><span class="line">df.map(lambda x:(x[0],x[1],x[2])).toDF([&quot;month&quot;,&quot;day&quot;,&quot;value&quot;]).partitionBy([&quot;month&quot;,&quot;day&quot;])</span><br><span class="line">1</span><br><span class="line">三 coalesce(numPartitions) 联合分区，用于将分区变少。不能指定按某些列联合分区</span><br><span class="line">df.coalesce(1).rdd.getNumPartitions()</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「百物易用是苏生」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;u010720408&#x2F;article&#x2F;details&#x2F;90229461</span><br></pre></td></tr></table></figure>

<h4 id="DataFrame-用法与sql的转化理解"><a href="#DataFrame-用法与sql的转化理解" class="headerlink" title="DataFrame 用法与sql的转化理解"></a>DataFrame 用法与sql的转化理解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data.groupBy(&quot;dept&quot;).avg(&quot;age&quot;)</span><br><span class="line">&#x3D;</span><br><span class="line">select dept ,avg(age) from data group by 1</span><br></pre></td></tr></table></figure>

<h4 id="DataSet的转化"><a href="#DataSet的转化" class="headerlink" title="DataSet的转化"></a>DataSet的转化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val df&#x3D;spark.read.json(&quot;people.json&quot;)</span><br><span class="line">case class Person(name:String ,age int)</span><br><span class="line">val ds:DataSet[Person] &#x3D;df.as[Person]</span><br><span class="line">val fileterDS&#x3D;ds.filter(p&#x3D;&gt;p.age &gt;3)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/dataFrame%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="ckg20i7em0000ogiu3w6kb1ig" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/spark问题汇总" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/spark%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/" class="article-date">
  <time datetime="2020-09-27T01:21:41.965Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h5 id="Exception-in-thread-“main”-org-apache-spark-SparkException-When-running-with-master-‘yarn’-either-HADOOP-CONF-DIR-or-YARN-CONF-DIR-must-be-set-in-the-environment"><a href="#Exception-in-thread-“main”-org-apache-spark-SparkException-When-running-with-master-‘yarn’-either-HADOOP-CONF-DIR-or-YARN-CONF-DIR-must-be-set-in-the-environment" class="headerlink" title="Exception in thread “main” org.apache.spark.SparkException: When running with master ‘yarn’ either HADOOP_CONF_DIR or YARN_CONF_DIR must be set in the environment."></a>Exception in thread “main” org.apache.spark.SparkException: When running with master ‘yarn’ either HADOOP_CONF_DIR or YARN_CONF_DIR must be set in the environment.</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> vim /etc/profile</span></span><br><span class="line"><span class="meta">#</span><span class="bash">添加以下两句话</span></span><br><span class="line">export HADOOP_CONF_DIR=$HADOOP_HOME/etc/hadoop</span><br><span class="line">export YARN_CONF_DIR=$HADOOP_HOME/etc/hadoop</span><br><span class="line"><span class="meta">$</span><span class="bash"> :wq</span></span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<h5 id="WARN-util-NativeCodeLoader-Unable-to-load-native-hadoop-library-for-your-platform…-using-builtin-java-classes-where-applicable-Exception-in-thread-“main”-java-lang-NoClassDefFoundError-org-apache-spark-sql-DataFrame"><a href="#WARN-util-NativeCodeLoader-Unable-to-load-native-hadoop-library-for-your-platform…-using-builtin-java-classes-where-applicable-Exception-in-thread-“main”-java-lang-NoClassDefFoundError-org-apache-spark-sql-DataFrame" class="headerlink" title="WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable  Exception in thread “main” java.lang.NoClassDefFoundError: org/apache/spark/sql/DataFrame"></a>WARN util.NativeCodeLoader: Unable to load native-hadoop library for your platform… using builtin-java classes where applicable  Exception in thread “main” java.lang.NoClassDefFoundError: org/apache/spark/sql/DataFrame</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">缺少依赖包</span><br></pre></td></tr></table></figure>

<h4 id="查看Spark运行的日志"><a href="#查看Spark运行的日志" class="headerlink" title="查看Spark运行的日志"></a>查看Spark运行的日志</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">模式 Cluster :需要使用yarn logs 查看日志</span><br><span class="line">模式client 日志会输出到客户端上。</span><br><span class="line">user :dataCenter</span><br><span class="line">applicationId </span><br><span class="line">yarn logs -applicationId id &gt; logsxx.tex</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="Spark-Could-not-find-CoarseGrainedScheduler-异常"><a href="#Spark-Could-not-find-CoarseGrainedScheduler-异常" class="headerlink" title="Spark: Could not find CoarseGrainedScheduler 异常"></a>Spark: Could not find CoarseGrainedScheduler 异常</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">这个可能是一个资源问题，应该给任务分配更多的 cores 和Executors，并且分配更多的内存。并且需要给RDD分配更多的分区 </span><br><span class="line"></span><br><span class="line">找到spark下的conf配置文件中的spark-env.sh</span><br><span class="line"></span><br><span class="line">在内容末尾添加配置参数</span><br><span class="line"></span><br><span class="line">SPARK_WORKER_CORES&#x3D;2</span><br><span class="line">SPARK_WORKER_MEMORY&#x3D;2g</span><br></pre></td></tr></table></figure>

<h4 id="org-apache-spark-SparkException-A-master-URL-must-be-set-in-your-configuration"><a href="#org-apache-spark-SparkException-A-master-URL-must-be-set-in-your-configuration" class="headerlink" title="org.apache.spark.SparkException: A master URL must be set in your configuration"></a>org.apache.spark.SparkException: A master URL must be set in your configuration</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">未知：</span><br><span class="line">可见这里的匿名内部类依赖类MethodPositionTest$的方法mapFun，所以会触发类MethodPositionTest$的加载以及静态代码块执行，触发报错；</span><br><span class="line"></span><br><span class="line">综上，不建议将spark的初始化代码放到main外，很容易出问题。</span><br><span class="line">问题2）当spark相关的初始化代码在main外时，为什么有时报错，有时不报错</span><br><span class="line">具体情形如下：</span><br><span class="line">1）如果main里边的transformation（示例中的map方法）不依赖外部函数调用，正常；</span><br><span class="line">2）如果main里边的transformation（示例中的map方法）依赖main里的函数，报错；</span><br><span class="line">3）如果main里边的transformation（示例中的map方法）依赖main外的函数，报错；</span><br><span class="line">解决：</span><br></pre></td></tr></table></figure>

<h4 id="java-io-IOException-unexpected-exception-type"><a href="#java-io-IOException-unexpected-exception-type" class="headerlink" title="java.io.IOException: unexpected exception type"></a>java.io.IOException: unexpected exception type</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">WARN TaskSetManager:66 - Lost task 0.0 in stage 0.0 (TID 0, 172.17.190.98, executor 1): java.io.IOException: unexpected exception type</span><br><span class="line">at java.io.ObjectStreamClass.throwMiscException(ObjectStreamClass.java:1736)</span><br><span class="line">at java.io.ObjectStreamClass.invokeReadResolve(ObjectStreamClass.java:1266)</span><br><span class="line">at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2078)</span><br><span class="line">at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1573)</span><br><span class="line">at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2287)</span><br><span class="line"></span><br><span class="line">解决：</span><br><span class="line">集群上的Scala版本号和打包时工具上的Scala版本号不一致，修改idea上的Scala版本号和集群保持一致。</span><br><span class="line">修改步骤：</span><br><span class="line">1.从File中选择Project Structure</span><br><span class="line">2.选中GlobalLibraries,删除原有Scala，添加需要的Scala版本号，然后选中download</span><br><span class="line">3.重新打包即可</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>all 未能成功加入。</p>
<h4 id="节点丢失问题"><a href="#节点丢失问题" class="headerlink" title="节点丢失问题"></a>节点丢失问题</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1、增加reload.sh</span><br></pre></td></tr></table></figure>

<h4 id="hbase"><a href="#hbase" class="headerlink" title="hbase"></a>hbase</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"> 16:05:39 ERROR executor.Executor: Exception in task 14.1 in stage 0.0 (TID 388)</span><br><span class="line">org.apache.spark.SparkException: Task failed while writing rows</span><br><span class="line">        at org.apache.spark.internal.io.SparkHadoopWriter$.org$apache$spark$internal$io$SparkHadoopWriter$$executeTask(SparkHadoopWriter.scala:155)</span><br><span class="line">        at org.apache.spark.internal.io.SparkHadoopWriter$$anonfun$3.apply(SparkHadoopWriter.scala:83)</span><br><span class="line">        at org.apache.spark.internal.io.SparkHadoopWriter$$anonfun$3.apply(SparkHadoopWriter.scala:78)</span><br><span class="line">        at org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)</span><br><span class="line">        at org.apache.spark.scheduler.Task.run(Task.scala:121)</span><br><span class="line">        at org.apache.spark.executor.Executor$TaskRunner$$anonfun$11.apply(Executor.scala:407)</span><br><span class="line">        at org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1408)</span><br><span class="line">        at org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:413)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line">Caused by: org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 517 actions: org.apache.hadoop.hbase.RegionTooBusyException: Over memstore limit&#x3D;512.0M, regionName&#x3D;6b8012b0496b21b4e54293ac0facb0f0, server&#x3D;nm-cdh-storage-015.e.189.cn,16020,1584958999992</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.HRegion.checkResources(HRegion.java:4361)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.HRegion.batchMutate(HRegion.java:3980)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.HRegion.batchMutate(HRegion.java:3920)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.RSRpcServices.doBatchOp(RSRpcServices.java:1034)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.RSRpcServices.doNonAtomicBatchOp(RSRpcServices.java:966)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.RSRpcServices.doNonAtomicRegionMutation(RSRpcServices.java:929)</span><br><span class="line">        at org.apache.hadoop.hbase.regionserver.RSRpcServices.multi(RSRpcServices.java:2681)</span><br><span class="line">        at org.apache.hadoop.hbase.shaded.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:42014)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:413)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:130)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:324)</span><br><span class="line">        at org.apache.hadoop.hbase.ipc.RpcExecutor$Handler.run(RpcExecutor.java:304)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="本地跑spark项目"><a href="#本地跑spark项目" class="headerlink" title="本地跑spark项目"></a>本地跑spark项目</h4><h5 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Error: A JNI error has occurred, please check your installation and try again</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.SecurityException: Invalid signature file digest for Manifest main attributes</span><br><span class="line">        at sun.security.util.SignatureFileVerifier.processImpl(Unknown Source)</span><br><span class="line">        at sun.security.util.SignatureFileVerifier.process(Unknown Source)</span><br><span class="line">        at java.util.jar.JarVerifier.processEntry(Unknown Source)</span><br><span class="line">        at java.util.jar.JarVerifier.update(Unknown Source)</span><br><span class="line">        at java.util.jar.JarFile.initializeVerifier(Unknown Source)</span><br><span class="line">        at java.util.jar.JarFile.getInputStream(Unknown Source)</span><br><span class="line">        at sun.misc.JarIndex.getJarIndex(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath$JarLoader$1.run(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath$JarLoader$1.run(Unknown Source)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at sun.misc.URLClassPath$JarLoader.ensureOpen(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath$JarLoader.&lt;init&gt;(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath$3.run(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath$3.run(Unknown Source)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at sun.misc.URLClassPath.getLoader(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath.getLoader(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath.getNextLoader(Unknown Source)</span><br><span class="line">        at sun.misc.URLClassPath.getResource(Unknown Source)</span><br><span class="line">        at java.net.URLClassLoader$1.run(Unknown Source)</span><br><span class="line">        at java.net.URLClassLoader$1.run(Unknown Source)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at java.net.URLClassLoader.findClass(Unknown Source)</span><br><span class="line">        at java.lang.ClassLoader.loadClass(Unknown Source)</span><br><span class="line">        at sun.misc.Launcher$AppClassLoader.loadClass(Unknown Source)</span><br><span class="line">        at java.lang.ClassLoader.loadClass(Unknown Source)</span><br><span class="line">        at sun.launcher.LauncherHelper.checkAndLoadMain(Unknown Source)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">解决办法：这是因为在使用Maven打包的时候导致某些包的重复引用，以至于打包之后的META-INF的目录下多出了一些*.SF,*.DSA,*.RSA文件所致，我们可以在pom文件里面加入以下配置：</span><br><span class="line">&lt;&lt;pom.xml&gt;&gt;</span><br><span class="line">  &lt;build&gt;</span><br><span class="line">  &lt;plugins&gt;</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;maven-shade-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.2&lt;&#x2F;version&gt;</span><br><span class="line">    &lt;configuration&gt;</span><br><span class="line">      &lt;filters&gt;</span><br><span class="line">        &lt;filter&gt;</span><br><span class="line">          &lt;artifact&gt;*:*&lt;&#x2F;artifact&gt;</span><br><span class="line">          &lt;excludes&gt;</span><br><span class="line">            &lt;exclude&gt;META-INF&#x2F;*.SF&lt;&#x2F;exclude&gt;</span><br><span class="line">            &lt;exclude&gt;META-INF&#x2F;*.DSA&lt;&#x2F;exclude&gt;</span><br><span class="line">            &lt;exclude&gt;META-INF&#x2F;*.RSA&lt;&#x2F;exclude&gt;</span><br><span class="line">          &lt;&#x2F;excludes&gt;</span><br><span class="line">        &lt;&#x2F;filter&gt;</span><br><span class="line">      &lt;&#x2F;filters&gt;</span><br><span class="line">    &lt;&#x2F;configuration&gt;</span><br><span class="line">  &lt;&#x2F;plugin&gt;</span><br><span class="line">  &lt;&#x2F;plugins&gt;</span><br><span class="line">  &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">重新打包：</span><br><span class="line">D盘下的tools_0808文件夹为例，打包的文件夹中必须存在MANIFEST.MF文件，存放的位置是</span><br><span class="line"></span><br><span class="line">D:\tools_0808\META-INF\MANIFEST.MF。</span><br><span class="line"></span><br><span class="line">dos命令如下：</span><br><span class="line"></span><br><span class="line">jar cvfm sparkP.jar sparkProject\META-INF\MANIFEST.MF -C sparkProject&#x2F; . </span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1、这个是什么需求</span><br><span class="line">2、原定在不同步数据到大数据集群，你的方案、问题、工作量是多少</span><br><span class="line">3、建议把数据同步到集群，工作量、成本是多少</span><br><span class="line"></span><br><span class="line">jar cvfm sparkP.jar sparkProject\META-INF\MANIFEST.MF -C sparkProject&#x2F; . </span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="本地运行spark，创建视图失败。"><a href="#本地运行spark，创建视图失败。" class="headerlink" title="本地运行spark，创建视图失败。"></a>本地运行spark，创建视图失败。</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">异常：需要替换sparkmaster的&#x2F;bin &#x2F;hadoop.dll  跟wistre.exe 文件</span><br><span class="line">且放置 到系统的System32目录下。</span><br></pre></td></tr></table></figure>

<h4 id="spark查询hdfs文件是否存在"><a href="#spark查询hdfs文件是否存在" class="headerlink" title="spark查询hdfs文件是否存在"></a>spark查询hdfs文件是否存在</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; sc 为sparkContext;</span><br><span class="line">val config &#x3D; sc.hadoopConfiguration</span><br><span class="line">       val fs &#x3D; org.apache.hadoop.fs.FileSystem.get(config)</span><br><span class="line">       val path &#x3D; s&quot;&#x2F;year&#x3D;$&#123;year&#125;&#x2F;month&#x3D;$&#123;month&#125;&#x2F;day&#x3D;$&#123;day&#125;&quot;</span><br><span class="line">       val exists &#x3D; fs.exists(new org.apache.hadoop.fs.Path(ConfigParam.HiveZhczHistory + path))</span><br></pre></td></tr></table></figure>

<h4 id="shell判断HFDS文件是否存在"><a href="#shell判断HFDS文件是否存在" class="headerlink" title="shell判断HFDS文件是否存在"></a>shell判断HFDS文件是否存在</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hadoop fs -test -e &#x2F;hdfs_dir</span><br><span class="line">if [$? -ne 0];then</span><br><span class="line">	echo &quot;Directory not exists!&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">管理平台</span><br><span class="line">接口调用</span><br><span class="line"></span><br><span class="line">每个集群各有两个。接口大概在十几个。</span><br><span class="line">目前：管理平台有一个，新内蒙。</span><br><span class="line">沙溪没有管理平台  ，管理平台在沙溪上也有。</span><br><span class="line"></span><br><span class="line">策略， 跟管理平台 要交互， 新增api ，要如果更新 redis.</span><br><span class="line">放内存。 提供一个接口， 写到后台服务器的内存里面。 我可以写到个文件里。</span><br><span class="line">内存的数据。 </span><br><span class="line"></span><br><span class="line">权限控制。 参数 层面。  </span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/spark%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/" data-id="ckg20i7f00006ogiu4mh2hyo4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/hbase相关命令" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" class="article-date">
  <time datetime="2020-09-27T01:21:41.930Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>[TOC]</p>
<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">start-dfs.sh  </span><br><span class="line">start-yarn.sh</span><br><span class="line">zkServer.sh start #每台节点都启动zookeeper</span><br><span class="line">hbase-daemon.sh start master	#master节点启动</span><br><span class="line">hbase-daemon.sh start regionserver  #子节点启动</span><br><span class="line">hbase shell</span><br><span class="line">hbase-daemon.sh stop master #停止</span><br><span class="line">hbase-daemon.sh stop regionserver #停止</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">默认端口：60010</span><br><span class="line">hdfs:50070</span><br><span class="line">yarn：8088</span><br><span class="line">hbase hbck -fixMeta</span><br><span class="line"></span><br><span class="line">1、HDFS页面：50070</span><br><span class="line"></span><br><span class="line">2、YARN的管理界面：8088</span><br><span class="line"></span><br><span class="line">3、HistoryServer的管理界面：19888</span><br><span class="line"></span><br><span class="line">4、Zookeeper的服务端口号：2181</span><br><span class="line"></span><br><span class="line">5、Mysql的服务端口号：3306</span><br><span class="line"></span><br><span class="line">6、Hive.server1&#x3D;10000</span><br><span class="line"></span><br><span class="line">7、Kafka的服务端口号：9092</span><br><span class="line"></span><br><span class="line">8、azkaban界面：8443</span><br><span class="line"></span><br><span class="line">9、Hbase界面：16010,60010</span><br><span class="line"></span><br><span class="line">10、Spark的界面：8080</span><br><span class="line"></span><br><span class="line">11、Spark的URL：7077</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">hadoop的数据库</span><br><span class="line"></span><br><span class="line">hadoop的分布式、开源 、多版本的非关系型数据库</span><br><span class="line"></span><br><span class="line">Hbase存储Key-Value格式，面向列存储，Hbase底层为字节数据，没有数据类型一说。</span><br></pre></td></tr></table></figure>



<h3 id="Hbase特性："><a href="#Hbase特性：" class="headerlink" title="Hbase特性："></a>Hbase特性：</h3><ul>
<li>```<ul>
<li>线性和模块化可扩展性</li>
<li>严格一致的读写</li>
<li>表的自动和可配置分片</li>
<li>RegionServer之间的自动故障转移支持</li>
<li>方便的基类，用于通过Apache HBase表备份Hadoop MapReduce作业</li>
<li>易于使用的Java API用于客户端访问</li>
<li>块缓存和布隆过滤器用于实时查询</li>
<li>通过服务器端过滤器查询谓词下推</li>
<li>Thrift网关和支持XML，Protobuf和二进制数据编码选项的REST-ful Web服务</li>
<li>可扩展的基于Jruby的（JIRB）外壳</li>
<li>支持通过Hadoop指标子系统将指标导出到文件或Ganglia；或通过JMX<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">  </span><br><span class="line"></span><br><span class="line">## Hbase shell</span><br><span class="line"></span><br><span class="line">### hbase 检测</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<ol>
<li>检查region是否正常以及修复</li>
</ol>
<p>#bin/hbase hbck   (检查)<br>#bin/hbase hbck -fix （修复）<br>#bin/hbase hbck -fixMeta<br>#bin/hbase hbck -fixAssignments<br>#bin/hbase hbck -repair</p>
<p>会返回所有的region是否正常挂载，如没有正常挂载可以使用下一条命令修复，如果还是不能修复，那需要看日志为什么失败，手工处理。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>快照复制之后。新集群的问题：</p>
<p>You need to create a new .regioninfo and region dir in hdfs to plug the hole.</p>
<p>hbase hbck -fixHdfsHoles<br>hbase hbck -fixAssignments -fixMete</p>
<p>问题：！！！！！！！！！<br>Exception in thread “main” java.io.IOException: Duplicate hbck - Abort<br>    at org.apache.hadoop.hbase.util.HBaseFsck.connect(HBaseFsck.java:564)<br>    at org.apache.hadoop.hbase.util.HBaseFsck.exec(HBaseFsck.java:5119)<br>    at org.apache.hadoop.hbase.util.HBaseFsck$HBaseFsckTool.run(HBaseFsck.java:4941)<br>    at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:70)<br>    at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:84)<br>    at org.apache.hadoop.hbase.util.HBaseFsck.main(HBaseFsck.java:4929)</p>
<p>-encoding UTF-8 -charset UTF-8</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
<p>前提：HDFS fsck确保hbase根目录下文件没有损坏丢失，如果有，则先进行corrupt block移除。<br>切记：一定要在所有Region都上线之后再修复，否则修复之后可能出现重复Region。</p>
<p>步骤1. hbase hbck 检查输出所以ERROR信息，每个ERROR都会说明错误信息。<br>步骤2. hbase hbck -fixTableOrphans 先修复tableinfo缺失问题，根据内存cache或者hdfs table 目录结构，重新生成tableinfo文件。<br>步骤3. hbase hbck -fixHdfsOrphans 修复regioninfo缺失问题，根据region目录下的hfile重新生成regioninfo文件。<br>步骤4. hbase hbck -fixHdfsOverlaps 修复region重叠问题，merge重叠的region为一个region目录，并从新生成一个regioninfo。<br>步骤5. hbase hbck -fixHdfsHoles 修复region缺失，利用缺失的rowkey范围边界，生成新的region目录以及regioninfo填补这个空洞。<br>步骤6. hbase hbck -fixMeta 修复meta表信息，利用regioninfo信息，重新生成对应meta row填写到meta表中，并为其填写默认的分配regionserver。<br>步骤7. hbase hbck -fixAssignments 把这些offline的region触发上线，当region开始重新open 上线的时候，会被重新分配到真实的RegionServer上 , 并更新meta表上对应的行信息。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">### namespace</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;sql</span><br><span class="line">1. list_namespace:查询所有命名空间</span><br><span class="line">hbase(main):001:0&gt; list_namespace</span><br><span class="line">NAMESPACE                                                                       </span><br><span class="line">default                                                                         </span><br><span class="line">hbase</span><br><span class="line"></span><br><span class="line">2. list_namespace_tables : 查询指定命名空间的表</span><br><span class="line">hbase(main):014:0&gt; list_namespace_tables &#39;hbase&#39;</span><br><span class="line">TABLE</span><br><span class="line">meta</span><br><span class="line">namespace</span><br><span class="line"></span><br><span class="line">3. create_namespace : 创建指定的命名空间</span><br><span class="line">hbase(main):018:0&gt; create_namespace &#39;myns&#39;</span><br><span class="line">hbase(main):019:0&gt; list_namespace</span><br><span class="line">NAMESPACE</span><br><span class="line">default</span><br><span class="line">hbase</span><br><span class="line">myns</span><br><span class="line"></span><br><span class="line">4. describe_namespace : 查询指定命名空间的结构</span><br><span class="line">hbase(main):021:0&gt; describe_namespace &#39;myns&#39;</span><br><span class="line">DESCRIPTION</span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;myns&#39;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">5. alter_namespace ：修改命名空间的结构</span><br><span class="line">hbase(main):022:0&gt;  alter_namespace &#39;myns&#39;, &#123;METHOD &#x3D;&gt; &#39;set&#39;, &#39;name&#39; &#x3D;&gt; &#39;eRRRchou&#39;&#125;</span><br><span class="line"></span><br><span class="line">hbase(main):023:0&gt; describe_namespace &#39;myns&#39;</span><br><span class="line">DESCRIPTION</span><br><span class="line">&#123;NAME &#x3D;&gt; &#39;myns&#39;, name &#x3D;&gt; &#39;eRRRchou&#39;&#125;</span><br><span class="line">修改命名空间的结构&#x3D;&gt;删除name</span><br><span class="line">hbase(main):022:0&gt; alter_namespace &#39;myns&#39;, &#123;METHOD &#x3D;&gt; &#39;unset&#39;, NAME &#x3D;&gt; &#39;name&#39;&#125;</span><br><span class="line">hbase(main):023:0&gt; describe_namespace &#39;myns&#39;</span><br><span class="line"></span><br><span class="line">6. 删除命名空间</span><br><span class="line">hbase(main):026:0&gt; drop_namespace &#39;myns&#39;</span><br><span class="line"></span><br><span class="line">hbase(main):027:0&gt; list_namespace</span><br><span class="line">NAMESPACE</span><br><span class="line">default</span><br><span class="line">hbase</span><br><span class="line"></span><br><span class="line">7. 利用新添加的命名空间建表</span><br><span class="line">hbase(main):032:0&gt; create &#39;myns:t1&#39;, &#39;f1&#39;, &#39;f2&#39;</span><br><span class="line"></span><br><span class="line">8.查询表快照</span><br><span class="line">hbase(main):033:0&gt; list_snapshot</span><br><span class="line"></span><br><span class="line">9.创建快照</span><br><span class="line">hbase(main):033:0&gt;  snapshot &#39;tablename&#39;,&#39;snapshotname&#39;</span><br><span class="line">10.删除快照</span><br></pre></td></tr></table></figure>

<h3 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">1. 查询所有表</span><br><span class="line">hbase(main):002:0&gt; list</span><br><span class="line">TABLE                                                                           </span><br><span class="line">HelloHbase                                                                      </span><br><span class="line">kylin_metadata                                                                  </span><br><span class="line">myns:t1                                                                         </span><br><span class="line">3 row(s) in 0.0140 seconds</span><br><span class="line"></span><br><span class="line">=&gt; [&quot;HelloHbase&quot;, &quot;kylin_metadata&quot;, &quot;myns:t1&quot;]</span><br><span class="line"></span><br><span class="line">2. <span class="keyword">describe</span> : 查询表结构</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">003</span>:<span class="number">0</span>&gt; <span class="keyword">describe</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line"></span><br><span class="line">&#123;<span class="keyword">NAME</span> =&gt; <span class="string">&#x27;f1&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, <span class="keyword">VERSIONS</span> =&gt; <span class="string">&#x27;1&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, <span class="keyword">KEEP</span></span><br><span class="line">_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, COMP</span><br><span class="line">RESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, <span class="keyword">BLOCKSIZE</span> =&gt; <span class="string">&#x27;6553</span></span><br><span class="line"><span class="string">6&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;                                                   </span><br><span class="line">&#123;<span class="keyword">NAME</span> =&gt; <span class="string">&#x27;f2&#x27;</span>, BLOOMFILTER =&gt; <span class="string">&#x27;ROW&#x27;</span>, <span class="keyword">VERSIONS</span> =&gt; <span class="string">&#x27;1&#x27;</span>, IN_MEMORY =&gt; <span class="string">&#x27;false&#x27;</span>, <span class="keyword">KEEP</span></span><br><span class="line">_DELETED_CELLS =&gt; <span class="string">&#x27;FALSE&#x27;</span>, DATA_BLOCK_ENCODING =&gt; <span class="string">&#x27;NONE&#x27;</span>, TTL =&gt; <span class="string">&#x27;FOREVER&#x27;</span>, COMP</span><br><span class="line">RESSION =&gt; <span class="string">&#x27;NONE&#x27;</span>, MIN_VERSIONS =&gt; <span class="string">&#x27;0&#x27;</span>, BLOCKCACHE =&gt; <span class="string">&#x27;true&#x27;</span>, <span class="keyword">BLOCKSIZE</span> =&gt; <span class="string">&#x27;6553</span></span><br><span class="line"><span class="string">6&#x27;</span>, REPLICATION_SCOPE =&gt; <span class="string">&#x27;0&#x27;</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="number">3.</span> 创建分片表</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">007</span>:<span class="number">0</span>&gt; <span class="keyword">create</span> <span class="string">&#x27;myns:t2&#x27;</span>, <span class="string">&#x27;f1&#x27;</span>, SPLITS =&gt; [<span class="string">&#x27;10&#x27;</span>, <span class="string">&#x27;20&#x27;</span>, <span class="string">&#x27;30&#x27;</span>, <span class="string">&#x27;40&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="number">4.</span> 修改表，添加修改列簇信息</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">009</span>:<span class="number">0</span>&gt; <span class="keyword">alter</span> <span class="string">&#x27;myns:t1&#x27;</span>, &#123;<span class="keyword">NAME</span>=&gt;<span class="string">&#x27;info1&#x27;</span>&#125;</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">010</span>:<span class="number">0</span>&gt; <span class="keyword">describe</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">5.</span> 删除列簇</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">014</span>:<span class="number">0</span>&gt; <span class="keyword">alter</span> <span class="string">&#x27;myns:t1&#x27;</span>, &#123;<span class="string">&#x27;delete&#x27;</span> =&gt; <span class="string">&#x27;info1&#x27;</span>&#125;</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">015</span>:<span class="number">0</span>&gt; <span class="keyword">describe</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">6.</span> 删除表</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">016</span>:<span class="number">0</span>&gt; <span class="keyword">disable</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">016</span>:<span class="number">0</span>&gt; <span class="keyword">enable</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">017</span>:<span class="number">0</span>&gt; <span class="keyword">drop</span> <span class="string">&#x27;myns:t1&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="number">7.</span><span class="keyword">truncate</span> <span class="string">&#x27;zhpt:user_info&#x27;</span></span><br><span class="line"><span class="number">7</span>、负载均衡</span><br><span class="line">hbase(<span class="keyword">main</span>):<span class="number">017</span>:<span class="number">0</span>&gt; balance</span><br><span class="line"></span><br><span class="line"><span class="number">8</span> 创建表:</span><br><span class="line"><span class="keyword">create</span> <span class="string">&#x27;zhpt:user_info&#x27;</span>, <span class="string">&#x27;m&#x27;</span>, SPLITS =&gt; [<span class="string">&#x27;04444444&#x27;</span>,<span class="string">&#x27;08888888&#x27;</span>,<span class="string">&#x27;0CCCCCCC&#x27;</span>,<span class="string">&#x27;11111110&#x27;</span>,<span class="string">&#x27;15555554&#x27;</span>,<span class="string">&#x27;19999998&#x27;</span>,<span class="string">&#x27;1DDDDDDC&#x27;</span>,<span class="string">&#x27;22222220&#x27;</span>,<span class="string">&#x27;26666664&#x27;</span>,<span class="string">&#x27;2AAAAAA8&#x27;</span>,<span class="string">&#x27;2EEEEEEC&#x27;</span>,<span class="string">&#x27;33333330&#x27;</span>,<span class="string">&#x27;37777774&#x27;</span>,<span class="string">&#x27;3BBBBBB8&#x27;</span>,<span class="string">&#x27;3FFFFFFC&#x27;</span>,<span class="string">&#x27;44444440&#x27;</span>,<span class="string">&#x27;48888884&#x27;</span>,<span class="string">&#x27;4CCCCCC8&#x27;</span>,<span class="string">&#x27;5111110C&#x27;</span>,<span class="string">&#x27;55555550&#x27;</span>,<span class="string">&#x27;59999994&#x27;</span>,<span class="string">&#x27;5DDDDDD8&#x27;</span>,<span class="string">&#x27;6222221C&#x27;</span>,<span class="string">&#x27;66666660&#x27;</span>,<span class="string">&#x27;6AAAAAA4&#x27;</span>,<span class="string">&#x27;6EEEEEE8&#x27;</span>,<span class="string">&#x27;7333332C&#x27;</span>,<span class="string">&#x27;77777770&#x27;</span>,<span class="string">&#x27;7BBBBBB4&#x27;</span>,<span class="string">&#x27;7FFFFFF8&#x27;</span>,<span class="string">&#x27;8444443C&#x27;</span>,<span class="string">&#x27;88888880&#x27;</span>,<span class="string">&#x27;8CCCCCC4&#x27;</span>,<span class="string">&#x27;91111108&#x27;</span>,<span class="string">&#x27;9555554C&#x27;</span>,<span class="string">&#x27;99999990&#x27;</span>,<span class="string">&#x27;9DDDDDD4&#x27;</span>,<span class="string">&#x27;A2222218&#x27;</span>,<span class="string">&#x27;A666665C&#x27;</span>,<span class="string">&#x27;AAAAAAA0&#x27;</span>,<span class="string">&#x27;AEEEEEE4&#x27;</span>,<span class="string">&#x27;B3333328&#x27;</span>,<span class="string">&#x27;B777776C&#x27;</span>,<span class="string">&#x27;BBBBBBB0&#x27;</span>,<span class="string">&#x27;BFFFFFF4&#x27;</span>,<span class="string">&#x27;C4444438&#x27;</span>,<span class="string">&#x27;C888887C&#x27;</span>,<span class="string">&#x27;CCCCCCC0&#x27;</span>,<span class="string">&#x27;D1111104&#x27;</span>,<span class="string">&#x27;D5555548&#x27;</span>,<span class="string">&#x27;D999998C&#x27;</span>,<span class="string">&#x27;DDDDDDD0&#x27;</span>,<span class="string">&#x27;E2222214&#x27;</span>,<span class="string">&#x27;E6666658&#x27;</span>,<span class="string">&#x27;EAAAAA9C&#x27;</span>,<span class="string">&#x27;EEEEEEE0&#x27;</span>,<span class="string">&#x27;F3333324&#x27;</span>,<span class="string">&#x27;F7777768&#x27;</span>,<span class="string">&#x27;FBBBBBAC&#x27;</span>]</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">用到的表创建语句：</span><br><span class="line">hbase(main):011:0&gt; create &#x27;myns:user_info&#x27;,&#x27;base_info&#x27;,&#x27;extra_info&#x27;</span><br><span class="line"></span><br><span class="line">1. 插入数据（put命令，不能一次性插入多条）</span><br><span class="line">hbase(main):012:0&gt; put &#x27;myns:user_info&#x27;,&#x27;001&#x27;,&#x27;base_info:username&#x27;,&#x27;张三&#x27;</span><br><span class="line"></span><br><span class="line">2. scan扫描</span><br><span class="line">hbase(main):024:0&gt; scan &#x27;myns:user_info&#x27;</span><br><span class="line"></span><br><span class="line">3. 通过指定版本查询</span><br><span class="line">hbase(main):024:0&gt; scan &#x27;myns:user_info&#x27;, &#123;RAW =&gt; true, VERSIONS =&gt; 1&#125;</span><br><span class="line">hbase(main):024:0&gt; scan &#x27;myns:user_info&#x27;, &#123;RAW =&gt; true, VERSIONS =&gt; 2&#125;</span><br><span class="line"></span><br><span class="line">4. 查询指定列的数据</span><br><span class="line">hbase(main):014:0&gt; scan &#x27;myns:user_info&#x27;,&#123;COLUMNS =&gt; &#x27;base_info:username&#x27;&#125;</span><br><span class="line">4-1. 查询指定列的数据并且过滤</span><br><span class="line">hbase(main):014:0&gt; scan &#x27;myns:user_info&#x27;,&#123;COLUMNS =&gt; &#x27;base_info:username&#x27;&#125;，</span><br><span class="line">FILTER =&gt;&quot;ValueFilter(=,&#x27;binary:1&#x27;) &quot;    binary 二进制等于</span><br><span class="line">4-2 前缀过滤查询</span><br><span class="line"> scan &#x27;bill:t_rel_account_base&#x27;,&#123;ROWPREFIXFILTER=&gt;&#x27;000000&#x27;&#125;</span><br><span class="line"></span><br><span class="line">hbase(main):014:0&gt; scan &#x27;myns:user_info&#x27;,&#123;COLUMNS =&gt; &#x27;base_info:username&#x27;&#125;，</span><br><span class="line">FILTER =&gt;&quot;ValueFilter(=,&#x27;binary:1&#x27;)&quot;    binary 二进制等于</span><br><span class="line"></span><br><span class="line">5. 分页查询</span><br><span class="line">hbase(main):021:0&gt; scan &#x27;myns:user_info&#x27;, &#123;COLUMNS =&gt; [&#x27;base_info:username&#x27;], LIMIT =&gt; 10, STARTROW =&gt; &#x27;001&#x27;&#125;</span><br><span class="line"></span><br><span class="line">6. get查询</span><br><span class="line">hbase(main):015:0&gt; get &#x27;myns:user_info&#x27;,&#x27;001&#x27;,&#x27;base_info:username&#x27;</span><br><span class="line">hbase(main):017:0&gt; put &#x27;myns:user_info&#x27;,&#x27;001&#x27;,&#x27;base_info:love&#x27;,&#x27;basketball&#x27;</span><br><span class="line">hbase(main):018:0&gt; get &#x27;myns:user_info&#x27;,&#x27;001&#x27;</span><br><span class="line"></span><br><span class="line">7. 根据时间戳查询 是一个范围，包头不包尾</span><br><span class="line">hbase(main):029:0&gt; get &#x27;myns:user_info&#x27;,&#x27;001&#x27;, &#123;&#x27;TIMERANGE&#x27; =&gt; [1571650017702, 1571650614606]&#125;</span><br><span class="line"></span><br><span class="line">8. hbase排序</span><br><span class="line">插入到hbase中去的数据，hbase会自动排序存储：</span><br><span class="line">排序规则：  首先看行键，然后看列族名，然后看列（key）名； 按字典顺序</span><br><span class="line"></span><br><span class="line">9. 更新数据</span><br><span class="line">hbase(main):010:0&gt; put &#x27;myns:user_info&#x27;, &#x27;001&#x27;, &#x27;base_info:name&#x27;, &#x27;rock&#x27;</span><br><span class="line">hbase(main):011:0&gt; put &#x27;myns:user_info&#x27;, &#x27;001&#x27;, &#x27;base_info:name&#x27;, &#x27;eRRRchou&#x27;</span><br><span class="line"></span><br><span class="line">10. incr计数器</span><br><span class="line">hbase(main):053:0&gt; incr &#x27;myns:user_info&#x27;, &#x27;002&#x27;, &#x27;base_info:age3&#x27;</span><br><span class="line"></span><br><span class="line">11. 删除</span><br><span class="line">hbase(main):058:0&gt; delete &#x27;myns:user_info&#x27;, &#x27;002&#x27;, &#x27;base_info:age3&#x27;</span><br><span class="line"></span><br><span class="line">12. 删除一行</span><br><span class="line">hbase(main):028:0&gt; deleteall &#x27;myns:user_info&#x27;,&#x27;001&#x27;</span><br><span class="line"></span><br><span class="line">13. 删除一个版本</span><br><span class="line">hbase(main):081:0&gt; delete &#x27;myns:user_info&#x27;,&#x27;001&#x27;,&#x27;extra_info:feature&#x27;, TIMESTAMP=&gt;1546922931075</span><br><span class="line"></span><br><span class="line">14. 删除一个表</span><br><span class="line">hbase(main):082:0&gt; disable &#x27;myns:user_info&#x27;</span><br><span class="line">hbase(main):083:0&gt; drop &#x27;myns:user_info&#x27;</span><br><span class="line"></span><br><span class="line">15. 判断表是否存在</span><br><span class="line">hbase(main):084:0&gt; exists &#x27;myns:user_info&#x27;</span><br><span class="line"></span><br><span class="line">16. 表生效和失效</span><br><span class="line">hbase(main):085:0&gt; enable &#x27;myns:user_info&#x27;</span><br><span class="line">hbase(main):086:0&gt; disable &#x27;myns:user_info&#x27;</span><br><span class="line"></span><br><span class="line">17. 统计表行数</span><br><span class="line">hbase(main):088:0&gt; count &#x27;myns:user_info&#x27;</span><br><span class="line"></span><br><span class="line">18. 清空表数据</span><br><span class="line">hbase(main):089:0&gt; truncate &#x27;myns:user_info&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="Hbase-Java-Api"><a href="#Hbase-Java-Api" class="headerlink" title="Hbase Java Api"></a>Hbase Java Api</h2><h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.hbase<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hbase-client<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="HbaseUtils"><a href="#HbaseUtils" class="headerlink" title="HbaseUtils"></a>HbaseUtils</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HbaseUtils</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Configuration configuration = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExecutorService executor = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> HBaseAdmin hBaseAdmin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Admin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Connection conn = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Table table;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="comment">//1. 获取连接配置对象</span></span><br><span class="line">        configuration = <span class="keyword">new</span> Configuration();</span><br><span class="line">        <span class="comment">//2. 设置连接hbase的参数</span></span><br><span class="line">        configuration.set(<span class="string">&quot;hbase.zookeeper.quorum&quot;</span>, <span class="string">&quot;mini01:2181,mini02:2181,mini03:2181&quot;</span>);</span><br><span class="line">        <span class="comment">//3. 获取Admin对象</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            executor = Executors.newFixedThreadPool(<span class="number">20</span>);</span><br><span class="line">            conn = ConnectionFactory.createConnection(configuration, executor);</span><br><span class="line">            hBaseAdmin = (HBaseAdmin)conn.getAdmin();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> HBaseAdmin <span class="title">getHbaseAdmin</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> hBaseAdmin;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Table <span class="title">getTable</span><span class="params">(TableName tableName)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> conn.getTable(tableName);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(HBaseAdmin admin)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            admin.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(HBaseAdmin admin,Table table)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(admin!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                admin.close();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(table!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                table.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">(Table table)</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(table!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                table.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">showResult</span><span class="params">(Result result)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        CellScanner scanner = result.cellScanner();</span><br><span class="line">        <span class="keyword">while</span>(scanner.advance())&#123;</span><br><span class="line">            Cell cell = scanner.current();</span><br><span class="line">            System.out.print(<span class="string">&quot;\t&quot;</span> + <span class="keyword">new</span> String(CellUtil.cloneFamily(cell),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            System.out.print(<span class="string">&quot; : &quot;</span> + <span class="keyword">new</span> String(CellUtil.cloneQualifier(cell),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">            System.out.print(<span class="string">&quot;\t&quot;</span> + <span class="keyword">new</span> String(CellUtil.cloneValue(cell),<span class="string">&quot;utf-8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="HbaseDemo"><a href="#HbaseDemo" class="headerlink" title="HbaseDemo"></a>HbaseDemo</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HbaseDemo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  HBaseAdmin hBaseAdmin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span>  Admin admin = <span class="keyword">null</span>;</span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">            hBaseAdmin = HbaseUtils.getHbaseAdmin();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@After</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HbaseUtils.close(hBaseAdmin);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tableExists</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;  <span class="comment">//检查表是否存在</span></span><br><span class="line">        <span class="comment">//4. 检验指定表是否存在，来判断是否连接到hbase</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = hBaseAdmin.tableExists(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">        <span class="comment">//5. 打印</span></span><br><span class="line">        System.out.println(flag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listNamespace</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123; <span class="comment">//遍历命名空间</span></span><br><span class="line">        NamespaceDescriptor[] namespaceDescriptors = hBaseAdmin.listNamespaceDescriptors();</span><br><span class="line">        <span class="comment">// 打印</span></span><br><span class="line">        <span class="keyword">for</span>(NamespaceDescriptor namespaceDescriptor:namespaceDescriptors)&#123;</span><br><span class="line">            System.out.println(namespaceDescriptor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listTables</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;  <span class="comment">//获取表的名字</span></span><br><span class="line">        <span class="comment">//获取指定命名空间下的表</span></span><br><span class="line">        TableName[] tables = hBaseAdmin.listTableNamesByNamespace(<span class="string">&quot;myns&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;对应命名空间下的表名：&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (TableName table:tables)&#123;</span><br><span class="line">            System.out.println(table);</span><br><span class="line">        &#125;</span><br><span class="line">        tables = hBaseAdmin.listTableNames();</span><br><span class="line">        System.out.println(<span class="string">&quot;所有表名：&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (TableName table:tables)&#123;</span><br><span class="line">            System.out.println(table);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createNamespace</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">//创建namespace</span></span><br><span class="line">        hBaseAdmin.createNamespace(NamespaceDescriptor.create(<span class="string">&quot;eRRRchou&quot;</span>).build());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createTable</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">//创建表</span></span><br><span class="line">        HTableDescriptor descriptor = <span class="keyword">new</span> HTableDescriptor(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        <span class="comment">//创建列簇</span></span><br><span class="line">        HColumnDescriptor columnDescriptor1 = <span class="keyword">new</span> HColumnDescriptor(<span class="string">&quot;base_info&quot;</span>);</span><br><span class="line">        columnDescriptor1.setVersions(<span class="number">1</span>, <span class="number">5</span>); <span class="comment">//设置列簇版本从1到5</span></span><br><span class="line">        columnDescriptor1.setTimeToLive(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>); <span class="comment">//秒</span></span><br><span class="line">        <span class="comment">//创建列簇</span></span><br><span class="line">        HColumnDescriptor columnDescriptor2 = <span class="keyword">new</span> HColumnDescriptor(<span class="string">&quot;extra_info&quot;</span>);</span><br><span class="line">        columnDescriptor2.setVersions(<span class="number">1</span>, <span class="number">5</span>);</span><br><span class="line">        columnDescriptor2.setTimeToLive(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>); <span class="comment">// 秒为单位</span></span><br><span class="line">        <span class="comment">//绑定关系</span></span><br><span class="line">        descriptor.addFamily(columnDescriptor1);</span><br><span class="line">        descriptor.addFamily(columnDescriptor2);</span><br><span class="line">        <span class="comment">//创建表</span></span><br><span class="line">        hBaseAdmin.createTable(descriptor);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteTable</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">//删除Family</span></span><br><span class="line">        hBaseAdmin.disableTable(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">        hBaseAdmin.deleteTable(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">modifyFamily</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">//修改列簇</span></span><br><span class="line">        TableName tableName = TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">        <span class="comment">//HTableDescriptor descriptor = new HTableDescriptor(tableName);//原来的列簇消失 new了个新的</span></span><br><span class="line">        HTableDescriptor descriptor = hBaseAdmin.getTableDescriptor(tableName); <span class="comment">//获得原来的描述</span></span><br><span class="line">        HColumnDescriptor columnDescriptor = <span class="keyword">new</span> HColumnDescriptor(<span class="string">&quot;extra_info&quot;</span>);</span><br><span class="line">        columnDescriptor.setVersions(<span class="number">1</span>, <span class="number">5</span>); <span class="comment">//设置列簇版本从1到5</span></span><br><span class="line">        columnDescriptor.setTimeToLive(<span class="number">24</span>*<span class="number">60</span>*<span class="number">60</span>); <span class="comment">//秒</span></span><br><span class="line">        descriptor.addFamily(columnDescriptor);</span><br><span class="line">        hBaseAdmin.modifyTable(tableName,descriptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteFamily</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">//删除Family</span></span><br><span class="line">        hBaseAdmin.deleteColumn(<span class="string">&quot;myns:user_info&quot;</span>,<span class="string">&quot;extra_info&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteColumeFamily</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123; <span class="comment">///删除Family</span></span><br><span class="line">        TableName tableName = TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">        HTableDescriptor tableDescriptor = hBaseAdmin.getTableDescriptor(tableName);</span><br><span class="line">        tableDescriptor.removeFamily(<span class="string">&quot;extra_info&quot;</span>.getBytes());</span><br><span class="line">        hBaseAdmin.modifyTable(tableName,tableDescriptor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">listFamily</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;  <span class="comment">//遍历Family</span></span><br><span class="line">        TableName tableName = TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>);</span><br><span class="line">        HTableDescriptor tableDescriptor = hBaseAdmin.getTableDescriptor(tableName);</span><br><span class="line">        HColumnDescriptor[] columnFamilies = tableDescriptor.getColumnFamilies();</span><br><span class="line">        <span class="keyword">for</span>(HColumnDescriptor columnFamilie:columnFamilies)&#123;</span><br><span class="line">            System.out.println(columnFamilie.getNameAsString());</span><br><span class="line">            System.out.println(columnFamilie.getBlocksize());</span><br><span class="line">            System.out.println(columnFamilie.getBloomFilterType());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        HbaseUtils.close(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putDatas</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        Put put = <span class="keyword">new</span> Put(Bytes.toBytes(<span class="string">&quot;001&quot;</span>));</span><br><span class="line">        put.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;userName&quot;</span>),Bytes.toBytes(<span class="string">&quot;zhangsan&quot;</span>));</span><br><span class="line">        put.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;age&quot;</span>),Bytes.toBytes(<span class="number">18</span>));</span><br><span class="line">        put.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>),Bytes.toBytes(<span class="string">&quot;male&quot;</span>));</span><br><span class="line">        <span class="comment">//提交</span></span><br><span class="line">        table.put(put);</span><br><span class="line">        HbaseUtils.close(table);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchPutDatas</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        <span class="comment">//0. 创建集合</span></span><br><span class="line">        List&lt;Put&gt; list = <span class="keyword">new</span> ArrayList&lt;Put&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//1. 创建put对象指定行键</span></span><br><span class="line">        Put rk004 = <span class="keyword">new</span> Put(Bytes.toBytes(<span class="string">&quot;002&quot;</span>));</span><br><span class="line">        Put rk005 = <span class="keyword">new</span> Put(Bytes.toBytes(<span class="string">&quot;003&quot;</span>));</span><br><span class="line">        Put rk006 = <span class="keyword">new</span> Put(Bytes.toBytes(<span class="string">&quot;004&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2. 创建列簇</span></span><br><span class="line">        rk004.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>),Bytes.toBytes(<span class="string">&quot;gaoyuanyuan&quot;</span>));</span><br><span class="line">        rk005.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;age&quot;</span>),Bytes.toBytes(<span class="string">&quot;18&quot;</span>));</span><br><span class="line">        rk005.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>),Bytes.toBytes(<span class="string">&quot;2&quot;</span>));</span><br><span class="line">        rk006.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>),Bytes.toBytes(<span class="string">&quot;fanbinbin&quot;</span>));</span><br><span class="line">        rk006.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;age&quot;</span>),Bytes.toBytes(<span class="string">&quot;18&quot;</span>));</span><br><span class="line">        rk006.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>),Bytes.toBytes(<span class="string">&quot;2&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3. 添加数据</span></span><br><span class="line">        list.add(rk004);</span><br><span class="line">        list.add(rk005);</span><br><span class="line">        list.add(rk006);</span><br><span class="line">        table.put(list);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;001&quot;</span>));</span><br><span class="line">        Result result = table.get(get);</span><br><span class="line">        NavigableMap&lt;<span class="keyword">byte</span>[], <span class="keyword">byte</span>[]&gt; base_infos = result.getFamilyMap(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>));</span><br><span class="line">        <span class="keyword">for</span>(Map.Entry&lt;<span class="keyword">byte</span>[], <span class="keyword">byte</span>[]&gt; base_info:base_infos.entrySet())&#123;</span><br><span class="line">            String k = <span class="keyword">new</span> String(base_info.getKey());</span><br><span class="line">            String v = <span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(k.equals(<span class="string">&quot;age&quot;</span>)) &#123;</span><br><span class="line">                 v = String.valueOf(Bytes.toInt(base_info.getValue()));</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 v = <span class="keyword">new</span> String(base_info.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(k+<span class="string">&quot;:&quot;</span>+v);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData2</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        <span class="comment">//1. 获Get对象</span></span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;004&quot;</span>));</span><br><span class="line">        <span class="comment">//2. 通过table获取结果对象</span></span><br><span class="line">        Result result = table.get(get);</span><br><span class="line">        <span class="comment">//3. 获取表格扫描器</span></span><br><span class="line">        CellScanner cellScanner = result.cellScanner();</span><br><span class="line">        System.out.println(<span class="string">&quot;rowkey : &quot;</span> + result.getRow());</span><br><span class="line">        <span class="comment">//4. 遍历</span></span><br><span class="line">        <span class="keyword">while</span> (cellScanner.advance()) &#123;</span><br><span class="line">            <span class="comment">//5. 获取当前表格</span></span><br><span class="line">            Cell cell = cellScanner.current();</span><br><span class="line">            <span class="comment">//5.1 获取所有的列簇</span></span><br><span class="line">            <span class="keyword">byte</span>[] familyArray = cell.getFamilyArray();</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(familyArray, cell.getFamilyOffset(), cell.getFamilyLength()));</span><br><span class="line">            <span class="comment">//5.2 获取所有列</span></span><br><span class="line">            <span class="keyword">byte</span>[] qualifierArray = cell.getQualifierArray();</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(qualifierArray, cell.getQualifierOffset(), cell.getQualifierLength()));</span><br><span class="line">            <span class="comment">//5.3 获取所有的值</span></span><br><span class="line">            <span class="keyword">byte</span>[] valueArray = cell.getValueArray();</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(valueArray, cell.getValueOffset(), cell.getValueLength()));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getData3</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        <span class="comment">//1. 获得Get对象</span></span><br><span class="line">        Get get = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;004&quot;</span>));</span><br><span class="line">        <span class="comment">//2. 通过table获取结果对象</span></span><br><span class="line">        Result result = table.get(get);</span><br><span class="line">        <span class="comment">//3. 获取表格扫描器</span></span><br><span class="line">        CellScanner cellScanner = result.cellScanner();</span><br><span class="line">        <span class="comment">//4.遍历</span></span><br><span class="line">        <span class="keyword">while</span>(cellScanner.advance())&#123;</span><br><span class="line">            Cell cell = cellScanner.current();</span><br><span class="line">            <span class="comment">//获取所有的列簇</span></span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(CellUtil.cloneFamily(cell),<span class="string">&quot;utf8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(CellUtil.cloneQualifier(cell),<span class="string">&quot;utf8&quot;</span>));</span><br><span class="line">            System.out.println(<span class="keyword">new</span> String(CellUtil.cloneValue(cell),<span class="string">&quot;utf8&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">batchGetData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建集合存储get对象</span></span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        List&lt;Get&gt; gets = <span class="keyword">new</span> ArrayList&lt;Get&gt;();</span><br><span class="line">        <span class="comment">//2. 创建多个get对象</span></span><br><span class="line">        Get get1 = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;004&quot;</span>));</span><br><span class="line">        get1.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        get1.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>));</span><br><span class="line">        get1.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;age&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Get get2 = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;001&quot;</span>));</span><br><span class="line">        get2.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        get2.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>));</span><br><span class="line"></span><br><span class="line">        Get get3 = <span class="keyword">new</span> Get(Bytes.toBytes(<span class="string">&quot;003&quot;</span>));</span><br><span class="line">        get3.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;sex&quot;</span>));</span><br><span class="line">        get3.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;age&quot;</span>));</span><br><span class="line">        gets.add(get1);</span><br><span class="line">        gets.add(get2);</span><br><span class="line">        gets.add(get3);</span><br><span class="line">        Result[] results = table.get(gets);</span><br><span class="line">        <span class="keyword">for</span> (Result result:results)&#123;</span><br><span class="line">            HbaseUtils.showResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">scanTable</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="comment">//1. 创建扫描器</span></span><br><span class="line">        Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">        <span class="comment">//2. 添加扫描的行数包头不包尾</span></span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        scan.setStartRow(Bytes.toBytes(<span class="string">&quot;001&quot;</span>));</span><br><span class="line">        scan.setStopRow(Bytes.toBytes(<span class="string">&quot;006&quot;</span> + <span class="string">&quot;\001&quot;</span>));  <span class="comment">//小技巧</span></span><br><span class="line">        <span class="comment">//3. 添加扫描的列</span></span><br><span class="line">        scan.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">//4. 获取扫描器</span></span><br><span class="line">        ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">        Iterator&lt;Result&gt; it = scanner.iterator();</span><br><span class="line">        <span class="keyword">while</span> (it.hasNext())&#123;</span><br><span class="line">            Result result = it.next();</span><br><span class="line">            HbaseUtils.showResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteData</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">        <span class="comment">//1. 创建集合用于批量删除</span></span><br><span class="line">        List&lt;Delete&gt; dels = <span class="keyword">new</span> ArrayList&lt;Delete&gt;();</span><br><span class="line">        <span class="comment">//2. 创建删除数据对象</span></span><br><span class="line">        Delete del = <span class="keyword">new</span> Delete(Bytes.toBytes(<span class="string">&quot;004&quot;</span>));</span><br><span class="line">        del.addColumn(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>),Bytes.toBytes(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">//3. 添加到集合</span></span><br><span class="line">        dels.add(del);</span><br><span class="line">        <span class="comment">//4. 提交</span></span><br><span class="line">        table.delete(dels);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Hbase过滤器"><a href="#Hbase过滤器" class="headerlink" title="Hbase过滤器"></a>Hbase过滤器</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">filter</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//RegexStringComparator 正则</span></span><br><span class="line">    <span class="comment">//SubstringComparator; subString比较器</span></span><br><span class="line">    <span class="comment">//BinaryComparator 二进制比较器</span></span><br><span class="line">    <span class="comment">//and条件</span></span><br><span class="line">    FilterList filterList = <span class="keyword">new</span> FilterList(FilterList.Operator.MUST_PASS_ALL);</span><br><span class="line">    SingleColumnValueFilter nameFilter = <span class="keyword">new</span> SingleColumnValueFilter(Bytes.toBytes(<span class="string">&quot;base_info&quot;</span>), Bytes.toBytes(<span class="string">&quot;name&quot;</span>),</span><br><span class="line">            CompareFilter.CompareOp.LESS_OR_EQUAL,Bytes.toBytes(<span class="string">&quot;gaoyuanyuan&quot;</span>));</span><br><span class="line">    filterList.addFilter(nameFilter);</span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">    scan.setFilter(filterList);</span><br><span class="line">    Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">    ResultScanner scanner = table.getScanner(scan);</span><br><span class="line">    Iterator&lt;Result&gt; it = scanner.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext())&#123;</span><br><span class="line">        Result result = it.next();</span><br><span class="line">        HbaseUtils.showResult(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">familyFilter</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//RegexStringComparator 正则</span></span><br><span class="line">    <span class="comment">//SubstringComparator; subString比较器</span></span><br><span class="line">    <span class="comment">//BinaryComparator 二进制比较器</span></span><br><span class="line">    <span class="comment">//and条件</span></span><br><span class="line">    RegexStringComparator regexStringComparator = <span class="keyword">new</span> RegexStringComparator(<span class="string">&quot;^base&quot;</span>);</span><br><span class="line">    <span class="comment">//2. 创建FamilyFilter：结果中只包含满足条件的列簇信息</span></span><br><span class="line">    FamilyFilter familyFilter = <span class="keyword">new</span> FamilyFilter(CompareFilter.CompareOp.EQUAL, regexStringComparator);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.创建扫描器进行扫描</span></span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">    <span class="comment">//5. 设置过滤器</span></span><br><span class="line">    scan.setFilter(familyFilter);</span><br><span class="line">    <span class="comment">//6. 获取表对象</span></span><br><span class="line">    Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">    <span class="comment">//7. 扫描表</span></span><br><span class="line">    ResultScanner scanner = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        scanner = table.getScanner(scan);</span><br><span class="line">        <span class="comment">//8. 打印数据</span></span><br><span class="line">        Iterator&lt;Result&gt; iterator = scanner.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Result result = iterator.next();</span><br><span class="line">            HbaseUtils.showResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            table.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">rowFiter</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 创建RowFilter</span></span><br><span class="line">    BinaryComparator binaryComparator = <span class="keyword">new</span> BinaryComparator(Bytes.toBytes(<span class="string">&quot;002&quot;</span>));</span><br><span class="line">    RowFilter rowFilter = <span class="keyword">new</span> RowFilter(CompareFilter.CompareOp.EQUAL, binaryComparator);</span><br><span class="line">    <span class="comment">//4.创建扫描器进行扫描</span></span><br><span class="line">    Scan scan = <span class="keyword">new</span> Scan();</span><br><span class="line">    <span class="comment">//5. 设置过滤器</span></span><br><span class="line">    scan.setFilter(rowFilter);</span><br><span class="line">    <span class="comment">//6. 获取表对象</span></span><br><span class="line">    Table table = HbaseUtils.getTable(TableName.valueOf(<span class="string">&quot;myns:user_info&quot;</span>));</span><br><span class="line">    <span class="comment">//7. 扫描表</span></span><br><span class="line">    ResultScanner scanner = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        scanner = table.getScanner(scan);</span><br><span class="line">        <span class="comment">//8. 打印数据</span></span><br><span class="line">        Iterator&lt;Result&gt; iterator = scanner.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Result result = iterator.next();</span><br><span class="line">            HbaseUtils.showResult(result);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            table.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="phoenix-pom"><a href="#phoenix-pom" class="headerlink" title="phoenix-pom"></a>phoenix-pom</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;project xmlns&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0&quot; xmlns:xsi&#x3D;&quot;http:&#x2F;&#x2F;www.w3.org&#x2F;2001&#x2F;XMLSchema-instance&quot;</span><br><span class="line">   xsi:schemaLocation&#x3D;&quot;http:&#x2F;&#x2F;maven.apache.org&#x2F;POM&#x2F;4.0.0 http:&#x2F;&#x2F;maven.apache.org&#x2F;xsd&#x2F;maven-4.0.0.xsd&quot;&gt;</span><br><span class="line">   &lt;modelVersion&gt;4.0.0&lt;&#x2F;modelVersion&gt;</span><br><span class="line">   &lt;parent&gt;</span><br><span class="line">      &lt;groupId&gt;xxx.xxx.bigdata.xxxx.datacenter&lt;&#x2F;groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;project-pom&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.0.1-SNAPSHOT&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;relativePath&gt;..&#x2F;project-pom&#x2F;pom.xml&lt;&#x2F;relativePath&gt;</span><br><span class="line">   &lt;&#x2F;parent&gt;</span><br><span class="line"></span><br><span class="line">   &lt;artifactId&gt;member&lt;&#x2F;artifactId&gt;</span><br><span class="line">   &lt;packaging&gt;jar&lt;&#x2F;packaging&gt;</span><br><span class="line"></span><br><span class="line">   &lt;name&gt;member&lt;&#x2F;name&gt;</span><br><span class="line">   &lt;description&gt;会员数据模块&lt;&#x2F;description&gt;</span><br><span class="line"></span><br><span class="line">   &lt;properties&gt;</span><br><span class="line">      &lt;project.build.sourceEncoding&gt;UTF-8&lt;&#x2F;project.build.sourceEncoding&gt;</span><br><span class="line">      &lt;project.reporting.outputEncoding&gt;UTF-8&lt;&#x2F;project.reporting.outputEncoding&gt;</span><br><span class="line">      &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">   &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">   &lt;dependencies&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;xxx.xxx.frame3&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;common-utils&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;youx-frame3-common.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;xxx.xxx.frame3&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;common-dao&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;youx-frame3-common.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;xxx.xxx.frame3&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;common-service&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;youx-frame3-common.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;xxx.xxx.frame3&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;common-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;youx-frame3-common.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 查询kylin jdbc driver --&gt;</span><br><span class="line">      &lt;!--&lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.apache.kylin&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;kylin-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;kylin-jdbc.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;--&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 凤凰hbase插件 --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.apache.phoenix&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;phoenix-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;version&gt;$&#123;phoenix-core.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">         &lt;exclusions&gt;</span><br><span class="line">            &lt;exclusion&gt;</span><br><span class="line">               &lt;groupId&gt;org.slf4j&lt;&#x2F;groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;slf4j-log4j12&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;exclusion&gt;</span><br><span class="line">            &lt;exclusion&gt;</span><br><span class="line">               &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">               &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;&#x2F;exclusion&gt;</span><br><span class="line">         &lt;&#x2F;exclusions&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- 添加热部署配置 --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">         &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">         &lt;artifactId&gt;spring-boot-devtools&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">   &lt;&#x2F;dependencies&gt;</span><br><span class="line"></span><br><span class="line">   &lt;!-- 如果不加下面的插件，打的包不能直接通过jar -jar xxx.jar的方式运行 --&gt;</span><br><span class="line">   &lt;build&gt;</span><br><span class="line">      &lt;plugins&gt;</span><br><span class="line">         &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-maven-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">         &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">         &lt;!-- 打包jar文件时，配置manifest文件，加入lib包的jar依赖 --&gt;</span><br><span class="line">         &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-jar-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">               &lt;classesDirectory&gt;$&#123;project.build.directory&#125;&#x2F;classes&lt;&#x2F;classesDirectory&gt;</span><br><span class="line">               &lt;archive&gt;</span><br><span class="line">                  &lt;manifest&gt;</span><br><span class="line">                     &lt;mainClass&gt;xxx.xxx.bigdata.xxxx.datacenter.member.MemberApplication&lt;&#x2F;mainClass&gt;</span><br><span class="line">                     &lt;!-- 打包时 MANIFEST.MF文件不记录的时间戳版本 --&gt;</span><br><span class="line">                     &lt;useUniqueVersions&gt;false&lt;&#x2F;useUniqueVersions&gt;</span><br><span class="line">                     &lt;addClasspath&gt;true&lt;&#x2F;addClasspath&gt;</span><br><span class="line">                     &lt;classpathPrefix&gt;lib&#x2F;&lt;&#x2F;classpathPrefix&gt;</span><br><span class="line">                  &lt;&#x2F;manifest&gt;</span><br><span class="line">                  &lt;manifestEntries&gt;</span><br><span class="line">                     &lt;Class-Path&gt;&lt;&#x2F;Class-Path&gt;</span><br><span class="line">                  &lt;&#x2F;manifestEntries&gt;</span><br><span class="line">               &lt;&#x2F;archive&gt;</span><br><span class="line">               &lt;excludes&gt;</span><br><span class="line">                  &lt;!-- 指定打包时要排除的文件,支持正则 --&gt;</span><br><span class="line">                  &lt;exclude&gt;bootstrap.properties&lt;&#x2F;exclude&gt;</span><br><span class="line">               &lt;&#x2F;excludes&gt;</span><br><span class="line">            &lt;&#x2F;configuration&gt;</span><br><span class="line">         &lt;&#x2F;plugin&gt;</span><br><span class="line"></span><br><span class="line">         &lt;!-- 把依赖的jar包,打成一个lib文件夹 --&gt;</span><br><span class="line">         &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-dependency-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">            &lt;executions&gt;</span><br><span class="line">               &lt;execution&gt;</span><br><span class="line">                  &lt;id&gt;copy-dependencies&lt;&#x2F;id&gt;</span><br><span class="line">                  &lt;phase&gt;package&lt;&#x2F;phase&gt;</span><br><span class="line">                  &lt;goals&gt;</span><br><span class="line">                     &lt;goal&gt;copy-dependencies&lt;&#x2F;goal&gt;</span><br><span class="line">                  &lt;&#x2F;goals&gt;</span><br><span class="line">                  &lt;configuration&gt;</span><br><span class="line">                     &lt;type&gt;jar&lt;&#x2F;type&gt;</span><br><span class="line">                     &lt;includeTypes&gt;jar&lt;&#x2F;includeTypes&gt;</span><br><span class="line">                     &lt;outputDirectory&gt;</span><br><span class="line">                        $&#123;project.build.directory&#125;&#x2F;lib</span><br><span class="line">                     &lt;&#x2F;outputDirectory&gt;</span><br><span class="line">                  &lt;&#x2F;configuration&gt;</span><br><span class="line">               &lt;&#x2F;execution&gt;</span><br><span class="line">            &lt;&#x2F;executions&gt;</span><br><span class="line">         &lt;&#x2F;plugin&gt;</span><br><span class="line">      &lt;&#x2F;plugins&gt;</span><br><span class="line">   &lt;&#x2F;build&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;project&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">命令：</span><br><span class="line">1.disable &#39;空间名:表名&#39;</span><br><span class="line">2.alter &#39;空间名:表名&#39;, METHOD &#x3D;&gt; &#39;table_att&#39;,&#39;coprocessor&#39;&#x3D;&gt;&#39;|org.apache.hadoop.hbase.coprocessor.AggregateImplementation||&#39;</span><br><span class="line">3.enable &#39;空间名:表名&#39;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/" data-id="ckg20i7f20007ogiu0vh14bpj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/hbase-java-api" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase-java-api/" class="article-date">
  <time datetime="2020-09-27T01:21:41.916Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="Hbase-java-Api"><a href="#Hbase-java-Api" class="headerlink" title="Hbase-java-Api"></a>Hbase-java-Api</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">新增 ，根据tableName获取mutator,然后 新增put 每个put 添加family,columns 。</span><br><span class="line">mutator 可以为list 。list.add(put)</span><br><span class="line">motator.mulate(motator)</span><br></pre></td></tr></table></figure>





<h4 id="DefaultMapper"><a href="#DefaultMapper" class="headerlink" title="DefaultMapper"></a>DefaultMapper</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br></pre></td><td class="code"><pre><span class="line">package com._21cn.project.mapper;</span><br><span class="line">&#x2F;**</span><br><span class="line">*   @author:Porcupine</span><br><span class="line">*   @date:2020&#x2F;7&#x2F;6</span><br><span class="line">*   @description:com._21cn.project.mapper</span><br><span class="line">*&#x2F;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.lang.reflect.Field;</span><br><span class="line">import java.lang.reflect.Modifier;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import org.apache.hadoop.hbase.client.Mutation;</span><br><span class="line">import org.apache.hadoop.hbase.client.Put;</span><br><span class="line">import org.apache.hadoop.hbase.client.Result;</span><br><span class="line">import org.apache.hadoop.hbase.util.Bytes;</span><br><span class="line"></span><br><span class="line">import info.data.common.json.JsonWrap;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class DefaultMapper&lt;T&gt;  &#123;</span><br><span class="line">    private String columnFamily;</span><br><span class="line">    private Map&lt;String, Field&gt; colums &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">    private Class&lt;T&gt; clazz;</span><br><span class="line"></span><br><span class="line">    public DefaultMapper(Class&lt;T&gt; clazz) &#123;</span><br><span class="line">        super();</span><br><span class="line">        this.clazz &#x3D; clazz;</span><br><span class="line">        map();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public T result2object(Result result) throws IllegalAccessException, InstantiationException, IOException &#123;</span><br><span class="line">        if (result.size() &#x3D;&#x3D; 0) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">        T obj &#x3D; clazz.newInstance();</span><br><span class="line">        for (Entry&lt;String, Field&gt; entry : colums.entrySet()) &#123;</span><br><span class="line">            Field f &#x3D; entry.getValue();</span><br><span class="line">            byte[] val &#x3D; result.getValue(Bytes.toBytes(columnFamily), Bytes.toBytes(entry.getKey()));</span><br><span class="line">            if (val &#x3D;&#x3D; null) &#123;</span><br><span class="line">                continue;</span><br><span class="line">            &#125;</span><br><span class="line">            switch (f.getName()) &#123;</span><br><span class="line">                case &quot;Integer&quot;:</span><br><span class="line">                    f.setInt(obj, Bytes.toInt(val));</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;Long&quot;:</span><br><span class="line">                    f.setLong(obj, Bytes.toLong(val));</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;Boolean&quot;:</span><br><span class="line">                    f.setBoolean(obj, Bytes.toBoolean(val));</span><br><span class="line">                    break;</span><br><span class="line">                case &quot;String&quot;:</span><br><span class="line">                    f.set(obj, Bytes.toString(val));</span><br><span class="line">                    break;</span><br><span class="line">                default:</span><br><span class="line">                    f.set(obj, JsonWrap.readAsObject(Bytes.toString(val), f.getType()));</span><br><span class="line">                    break;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public List&lt;Mutation&gt; object2mutation(T t) throws IllegalAccessException, IOException &#123;</span><br><span class="line">        List&lt;Mutation&gt; list &#x3D; new ArrayList&lt;&gt;();</span><br><span class="line">        Field rowkeyField &#x3D; colums.get(&quot;rowkey&quot;);</span><br><span class="line">        String rowkey &#x3D; rowkeyField.get(t).toString();</span><br><span class="line">        for (Entry&lt;String, Field&gt; entry : colums.entrySet()) &#123;</span><br><span class="line">            Put put &#x3D; new Put(Bytes.toBytes(rowkey));</span><br><span class="line">            String conlumn &#x3D; entry.getKey();</span><br><span class="line">            Object val &#x3D; entry.getValue().get(t);</span><br><span class="line">            if (val !&#x3D; null) &#123;</span><br><span class="line">                put.addColumn(Bytes.toBytes(columnFamily), Bytes.toBytes(conlumn),</span><br><span class="line">                        Bytes.toBytes(JsonWrap.writeAsString(val)));</span><br><span class="line">                list.add(put);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 获取所有字段 字段名称与hbase一一对应，存在一个final+static字段为列簇字段名称</span><br><span class="line">     *</span><br><span class="line">     * @throws IllegalAccessException</span><br><span class="line">     * @throws IllegalArgumentException</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private void map() &#123;</span><br><span class="line">        Field[] fs &#x3D; clazz.getDeclaredFields();&#x2F;&#x2F; 得到类中的所有属性集合</span><br><span class="line">        for (int i &#x3D; 0; i &lt; fs.length; i++) &#123;</span><br><span class="line">            Field f &#x3D; fs[i];</span><br><span class="line">            f.setAccessible(true); &#x2F;&#x2F; 设置些属性是可以访问的</span><br><span class="line">            int m &#x3D; f.getModifiers();</span><br><span class="line">            if (!Modifier.isFinal(m) &amp;&amp; !Modifier.isStatic(m)) &#123;</span><br><span class="line">                colums.put(f.getName(), f);</span><br><span class="line">            &#125; else if (&quot;FAMILY&quot;.equals(f.getName())) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    columnFamily &#x3D; f.get(clazz).toString();</span><br><span class="line">                &#125; catch (IllegalArgumentException | IllegalAccessException e) &#123;</span><br><span class="line">                    columnFamily &#x3D; &quot;f0&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase-java-api/" data-id="ckg20i7ey0005ogiu35xjaqg6" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/hadoop集群环境搭建" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hadoop%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" class="article-date">
  <time datetime="2020-09-27T01:21:41.913Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一台云机，需要一个redis服务。<br>一、</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hadoop%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/" data-id="ckg20i7ex0004ogiubalhfrf3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/docker/" class="article-date">
  <time datetime="2020-09-27T01:21:41.906Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line">docker exec -it spark_master &#x2F;bin&#x2F;bash &#x2F;&#x2F;启动maste 账号</span><br></pre></td></tr></table></figure>

<h4 id="sparkETL"><a href="#sparkETL" class="headerlink" title="sparkETL"></a>sparkETL</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> cd &#x2F;opt&#x2F;hdfs&#x2F;</span><br><span class="line"> hdfs dfs -put yj_prod_putupload_success.log &#x2F;spark&#x2F;</span><br><span class="line">hdfs dfs -chown -R spark:spark &#x2F;spark&#x2F;demo   &#x2F;&#x2F;HDFS 授权</span><br><span class="line"> </span><br><span class="line">  spark-submit --master spark:&#x2F;&#x2F;master:7077 --jars .&#x2F;lib&#x2F;fastjson-1.2.70.jar,.&#x2F;lib&#x2F;javassist-3.26.0-GA.jar,.&#x2F;lib&#x2F;reflections-0.9.12.jar,.&#x2F;lib&#x2F;snakeyaml-1.26.jar --class org.leapord.spark.Main .&#x2F;sparkETL-0.0.1-SNAPSHOT.jar .&#x2F;sparkETL.yml</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/docker/" data-id="ckg20i7ew0003ogiu39oxb9cf" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hadoop集群/dataFrame的使用" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/dataFrame%E7%9A%84%E4%BD%BF%E7%94%A8/" class="article-date">
  <time datetime="2020-09-27T01:21:41.867Z" itemprop="datePublished">2020-09-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="DataFrame详解"><a href="#DataFrame详解" class="headerlink" title="DataFrame详解"></a>DataFrame详解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">环境：spark 2.4.0</span><br><span class="line">slaca :2.12以上</span><br></pre></td></tr></table></figure>

<h4 id="创建DataFrame的几种方式"><a href="#创建DataFrame的几种方式" class="headerlink" title="创建DataFrame的几种方式"></a>创建DataFrame的几种方式</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一种：rdd 转DF</span><br><span class="line">import session.implict._</span><br><span class="line">val df&#x3D; rdd.toDF(#columnName)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"> &#x2F;**</span><br><span class="line">     * 创建一个空的DataFrame，代表用户</span><br><span class="line">     * 有四列，分别代表ID、名字、年龄、生日</span><br><span class="line">     *&#x2F;</span><br><span class="line">    val colNames &#x3D; Array(&quot;id&quot;, &quot;name&quot;, &quot;age&quot;, &quot;birth&quot;)</span><br><span class="line">    &#x2F;&#x2F;为了简单起见，字段类型都为String</span><br><span class="line">    val schema &#x3D; StructType(colNames.map(fieldName &#x3D;&gt; StructField(fieldName, StringType, true)))</span><br><span class="line">    &#x2F;&#x2F;主要是利用了spark.sparkContext.emptyRDD</span><br><span class="line">    val emptyDf &#x3D; spark.createDataFrame(spark.sparkContext.emptyRDD[Row], schema)</span><br><span class="line"></span><br><span class="line">&#x2F;**</span><br><span class="line">**</span><br><span class="line">**</span><br><span class="line">&#x2F;</span><br><span class="line">val empty&#x3D; spark.emptyDataFrame.withColumn()</span><br></pre></td></tr></table></figure>



<h4 id="DataFrame的方法"><a href="#DataFrame的方法" class="headerlink" title="DataFrame的方法"></a>DataFrame的方法</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">DataFrame 的函数</span><br><span class="line">Action 操作</span><br><span class="line">1、 collect() ,返回值是一个数组，返回dataframe集合所有的行</span><br><span class="line">2、 collectAsList() 返回值是一个Java类型的数组，返回dataframe集合所有的行</span><br><span class="line">3、 count() 返回一个number类型的，返回dataframe集合的行数</span><br><span class="line">4、 describe(cols: String*) 返回一个通过数学计算的类表值(count, mean, stddev, min, and max)，这个可以传多个参数，中间用逗号分隔，如果有字段为空，那么不参与运算，只这对数值类型的字段。例如df.describe(&quot;age&quot;, &quot;height&quot;).show()</span><br><span class="line">5、 first() 返回第一行 ，类型是row类型</span><br><span class="line">6、 head() 返回第一行 ，类型是row类型</span><br><span class="line">7、 head(n:Int)返回n行  ，类型是row 类型</span><br><span class="line">8、 show()返回dataframe集合的值 默认是20行，返回类型是unit</span><br><span class="line">9、 show(n:Int)返回n行，，返回值类型是unit</span><br><span class="line">10、 table(n:Int) 返回n行  ，类型是row 类型</span><br><span class="line"></span><br><span class="line">dataframe的基本操作</span><br><span class="line">1、 cache()同步数据的内存</span><br><span class="line">2、 columns 返回一个string类型的数组，返回值是所有列的名字</span><br><span class="line">3、 dtypes返回一个string类型的二维数组，返回值是所有列的名字以及类型</span><br><span class="line">4、 explan()打印执行计划  物理的</span><br><span class="line">5、 explain(n:Boolean) 输入值为 false 或者true ，返回值是unit  默认是false ，如果输入true 将会打印 逻辑的和物理的</span><br><span class="line">6、 isLocal 返回值是Boolean类型，如果允许模式是local返回true 否则返回false</span><br><span class="line">7、 persist(newlevel:StorageLevel) 返回一个dataframe.this.type 输入存储模型类型</span><br><span class="line">8、 printSchema() 打印出字段名称和类型 按照树状结构来打印</span><br><span class="line">9、 registerTempTable(tablename:String) 返回Unit ，将df的对象只放在一张表里面，这个表随着对象的删除而删除了</span><br><span class="line">10、 schema 返回structType 类型，将字段名称和类型按照结构体类型返回</span><br><span class="line">11、 toDF()返回一个新的dataframe类型的</span><br><span class="line">12、 toDF(colnames：String*)将参数中的几个字段返回一个新的dataframe类型的，</span><br><span class="line">13、 unpersist() 返回dataframe.this.type 类型，去除模式中的数据</span><br><span class="line">14、 unpersist(blocking:Boolean)返回dataframe.this.type类型 true 和unpersist是一样的作用false 是去除RDD</span><br><span class="line"></span><br><span class="line">集成查询：</span><br><span class="line">1、 agg(expers:column*) 返回dataframe类型 ，同数学计算求值</span><br><span class="line">df.agg(max(&quot;age&quot;), avg(&quot;salary&quot;))</span><br><span class="line">df.groupBy().agg(max(&quot;age&quot;), avg(&quot;salary&quot;))</span><br><span class="line">2、 agg(exprs: Map[String, String])  返回dataframe类型 ，同数学计算求值 map类型的</span><br><span class="line">df.agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;,&quot;phone&quot;,&quot;count&quot;))</span><br><span class="line">df.groupBy().agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">3、 agg(aggExpr: (String, String), aggExprs: (String, String)*)  返回dataframe类型 ，同数学计算求值</span><br><span class="line">df.agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">df.groupBy().agg(Map(&quot;age&quot; -&gt; &quot;max&quot;, &quot;salary&quot; -&gt; &quot;avg&quot;))</span><br><span class="line">4、 apply(colName: String) 返回column类型，捕获输入进去列的对象</span><br><span class="line">5、 as(alias: String) 返回一个新的dataframe类型，就是原来的一个别名</span><br><span class="line">6、 col(colName: String)  返回column类型，捕获输入进去列的对象</span><br><span class="line">7、 cube(col1: String, cols: String*) 返回一个GroupedData类型，根据某些字段来汇总</span><br><span class="line">8、 distinct 去重 返回一个dataframe类型</span><br><span class="line">9、 drop(col: Column) 删除某列 返回dataframe类型</span><br><span class="line">10、 dropDuplicates(colNames: Array[String]) 删除相同的列 返回一个dataframe</span><br><span class="line">11、 except(other: DataFrame) 返回一个dataframe，返回在当前集合存在的在其他集合不存在的</span><br><span class="line">12、 explode[A, B](inputColumn: String, outputColumn: String)(f: (A) ⇒ TraversableOnce[B])(implicit arg0: scala.reflect.api.JavaUniverse.TypeTag[B]) 返回值是dataframe类型，这个 将一个字段进行更多行的拆分</span><br><span class="line">df.explode(&quot;name&quot;,&quot;names&quot;) &#123;name :String&#x3D;&gt; name.split(&quot; &quot;)&#125;.show();</span><br><span class="line">将name字段根据空格来拆分，拆分的字段放在names里面</span><br><span class="line">13、 filter(conditionExpr: String): 刷选部分数据，返回dataframe类型 df.filter(&quot;age&gt;10&quot;).show();  df.filter(df(&quot;age&quot;)&gt;10).show();   df.where(df(&quot;age&quot;)&gt;10).show(); 都可以</span><br><span class="line">14、 groupBy(col1: String, cols: String*) 根据某写字段来汇总返回groupedate类型   df.groupBy(&quot;age&quot;).agg(Map(&quot;age&quot; -&gt;&quot;count&quot;)).show();df.groupBy(&quot;age&quot;).avg().show();都可以</span><br><span class="line">15、 intersect(other: DataFrame) 返回一个dataframe，在2个dataframe都存在的元素</span><br><span class="line">16、 join(right: DataFrame, joinExprs: Column, joinType: String)</span><br><span class="line">一个是关联的dataframe，第二个关联的条件，第三个关联的类型：inner, outer, left_outer, right_outer, leftsemi</span><br><span class="line">df.join(ds,df(&quot;name&quot;)&#x3D;&#x3D;&#x3D;ds(&quot;name&quot;) and  df(&quot;age&quot;)&#x3D;&#x3D;&#x3D;ds(&quot;age&quot;),&quot;outer&quot;).show();</span><br><span class="line">17、 limit(n: Int) 返回dataframe类型  去n 条数据出来</span><br><span class="line">18、 na: DataFrameNaFunctions ，可以调用dataframenafunctions的功能区做过滤 df.na.drop().show(); 删除为空的行</span><br><span class="line">df.na.fill(0)  为null的填充0</span><br><span class="line">19、 orderBy(sortExprs: Column*) 做alise排序</span><br><span class="line">20、 select(cols:string*) dataframe 做字段的刷选 df.select($&quot;colA&quot;, $&quot;colB&quot; + 1)</span><br><span class="line">21、 selectExpr(exprs: String*) 做字段的刷选 df.selectExpr(&quot;name&quot;,&quot;name as names&quot;,&quot;upper(name)&quot;,&quot;age+1&quot;).show();</span><br><span class="line">22、 sort(sortExprs: Column*) 排序 df.sort(df(&quot;age&quot;).desc).show(); 默认是asc</span><br><span class="line">23、 unionAll(other:Dataframe) 合并 df.unionAll(ds).show();</span><br><span class="line">24、 withColumnRenamed(existingName: String, newName: String) 修改列表 df.withColumnRenamed(&quot;name&quot;,&quot;names&quot;).show();</span><br><span class="line">25、 withColumn(colName: String, col: Column) 增加一列 df.withColumn(&quot;aa&quot;,df(&quot;name&quot;)).show();</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">四、如何设置合理的分区数</span><br><span class="line"></span><br><span class="line">1、分区数越多越好吗？</span><br><span class="line"></span><br><span class="line">不是的，分区数太多意味着任务数太多，每次调度任务也是很耗时的，所以分区数太多会导致总体耗时增多。</span><br><span class="line"></span><br><span class="line">2、分区数太少会有什么影响？</span><br><span class="line"></span><br><span class="line">分区数太少的话，会导致一些结点没有分配到任务；另一方面，分区数少则每个分区要处理的数据量就会增大，从而对每个结点的内存要求就会提高；还有分区数不合理，会导致数据倾斜问题。</span><br><span class="line"></span><br><span class="line">3、合理的分区数是多少？如何设置？</span><br><span class="line"></span><br><span class="line">总核数&#x3D;executor-cores * num-executor </span><br><span class="line"></span><br><span class="line">一般合理的分区数设置为总核数的2~3倍</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">一 repartition(numPartitions, *cols) 重新分区(内存中，用于并行度)，用于分区数变多，设置变小一般也只是action算子时才开始shuffing;而且当参数numPartitions小于当前分区个数时会保持当前分区个数等于失效。</span><br><span class="line">	df.reparition(100,&quot;month&quot;)</span><br><span class="line">1</span><br><span class="line">二 partitionBy(*cols) 根据指定列进行分区（主要磁盘存储，影响生成磁盘文件数量，后续再从存储中载入影响并行度），相似的在一个区，并没有参数来指定多少个分区，而且仅用于PairRdd</span><br><span class="line">df.map(lambda x:(x[0],x[1],x[2])).toDF([&quot;month&quot;,&quot;day&quot;,&quot;value&quot;]).partitionBy([&quot;month&quot;,&quot;day&quot;])</span><br><span class="line">1</span><br><span class="line">三 coalesce(numPartitions) 联合分区，用于将分区变少。不能指定按某些列联合分区</span><br><span class="line">df.coalesce(1).rdd.getNumPartitions()</span><br><span class="line">————————————————</span><br><span class="line">版权声明：本文为CSDN博主「百物易用是苏生」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。</span><br><span class="line">原文链接：https:&#x2F;&#x2F;blog.csdn.net&#x2F;u010720408&#x2F;article&#x2F;details&#x2F;90229461</span><br></pre></td></tr></table></figure>

<h4 id="DataFrame-用法与sql的转化理解"><a href="#DataFrame-用法与sql的转化理解" class="headerlink" title="DataFrame 用法与sql的转化理解"></a>DataFrame 用法与sql的转化理解</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">data.groupBy(&quot;dept&quot;).avg(&quot;age&quot;)</span><br><span class="line">&#x3D;</span><br><span class="line">select dept ,avg(age) from data group by 1</span><br></pre></td></tr></table></figure>

<h4 id="DataSet的转化"><a href="#DataSet的转化" class="headerlink" title="DataSet的转化"></a>DataSet的转化</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val df&#x3D;spark.read.json(&quot;people.json&quot;)</span><br><span class="line">case class Person(name:String ,age int)</span><br><span class="line">val ds:DataSet[Person] &#x3D;df.as[Person]</span><br><span class="line">val fileterDS&#x3D;ds.filter(p&#x3D;&gt;p.age &gt;3)</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/dataFrame%E7%9A%84%E4%BD%BF%E7%94%A8/" data-id="ckg20i7ev0002ogiu95zn7le4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/25/hello-world/" class="article-date">
  <time datetime="2020-09-25T04:14:36.409Z" itemprop="datePublished">2020-09-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/25/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/25/hello-world/" data-id="ckg20i7eu0001ogiucgu69vtj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/09/27/dataFrame%E7%9A%84%E4%BD%BF%E7%94%A8/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/spark%E9%97%AE%E9%A2%98%E6%B1%87%E6%80%BB/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hbase-java-api/">(no title)</a>
          </li>
        
          <li>
            <a href="/2020/09/27/hadoop%E9%9B%86%E7%BE%A4/hadoop%E9%9B%86%E7%BE%A4%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">(no title)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>